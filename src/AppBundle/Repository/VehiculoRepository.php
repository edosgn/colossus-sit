<?php

namespace AppBundle\Repository;

/**
 * VehiculoRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class VehiculoRepository extends \Doctrine\ORM\EntityRepository
{
    //Obtiene la lista de Usuario disponibles para vincular en la CampaÃ±a
    public function getVehiculoCampo($campo)
    {   
        $em = $this->getEntityManager();
        $dql = "SELECT v
            FROM AppBundle:Vehiculo v, AppBundle:CfgPlaca p
            WHERE ((v.placa = p.id)
            AND (p.numero = :campo))
            OR (v.vin = :campo)
            OR (v.chasis = :campo)
            OR (v.serie = :campo)
            OR (v.motor = :campo)
            ";
        $consulta = $em->createQuery($dql);
        
        $consulta->setParameters(array(
            'campo' => $campo,
        ));
        return $consulta->getOneOrNullResult();
    }

    public function getRna()
    {   
        $em = $this->getEntityManager();
        $dql = "SELECT v
            FROM AppBundle:Vehiculo v, AppBundle:Clase c, AppBundle:Modulo m
            WHERE c.id = v.clase
            AND m.id = c.modulo
            AND m.id = 1
            AND v.estado = true";
        $consulta = $em->createQuery($dql);
        return $consulta->getResult();
    }
}
